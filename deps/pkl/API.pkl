@go.Package { name = "github.com/kdeps/schema/pkg/core/api" }

module org.kdeps.pkl.API

import "package://pkg.pkl-lang.org/pkl-go/pkl.golang@0.5.0#/go.pkl"

class ResourceAPI {
    hidden apiMethodRegex = Regex(#"^(?i:(GET|POST|PUT|PATCH|DELETE|HEAD))"#)

    hidden isValidHTTPMethod = (str) ->
    if (str.matches(apiMethodRegex))
      true
    else
      throw("Error: Invalid HTTP method. The provided HTTP method is not supported. Please use one of the following methods: GET, POST, PUT, PATCH, DELETE, or HEAD.")

    hidden apiOutputPrefixRegex = Regex(#"^(?i:(ENV|FILE):)(.+$)"#)
    hidden isValidAPIOutputPrefix = (str) ->
    if (str.matches(apiOutputPrefixRegex))
      true
    else
      throw("Error: Invalid configuration string: The API output string does not match any of the expected formats: ENV:, FILE:. Please ensure that the string starts with one of these prefixes.")

    method: String(isValidHTTPMethod)
    url: Uri
    data: String
    output: String(isValidAPIOutputPrefix)? = "ENV:API_RESPONSE"
    headers: Listing<ResourceAPIHeaders>
}

class ResourceAPIHeaders {
    name: String
    value: String
}
