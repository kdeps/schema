/// Core PKL modules for KDEPS
///
/// This package contains essential modules used by the Kdeps framework,
/// providing fundamental functionalities and utilities to build upon.
///
/// Authors:
/// - Joel Bryan Juliano <joelbryan.juliano@gmail.com>
amends "pkl:Project"

// Reads the VERSION environment variables
local version_num = read?("env:VERSION")

package {
    // The name of the package.
    name = "core"

    // The authors of the package.
    authors {
        "Joel Bryan Juliano <joelbryan.juliano@gmail.com>"
    }

    // The version of the package, derived from the environment variable `VERSION`.
    // If the variable is not set, defaults to "0.0.1-SNAPSHOT".
    version = if (version_num != null) version_num.replaceFirst(Regex("^v(\\d+\\.\\d+\\.\\d+)(-[\\w\\.]+)?(\\+[\\w\\.]+)?$"), "$1").replaceFirst("\(name)@v", "") else "0.0.1-SNAPSHOT"

    // The base URI for the package, used for package resolution and access.
    baseUri = "package://schema.kdeps.com/core"

    // The URL for the zipped package release.
    packageZipUrl = if (version_num != null) "https://github.com/kdeps/schema/releases/download/\(version_num)/\(name)@\(version).zip" else "https://github.com/kdeps/schema/releases/download/v0.0.1-SNAPSHOT/\(name)@\(version).zip"

    // The URL for the source code repository.
    sourceCode = "https://github.com/kdeps/schema"

    // The URL scheme for linking to specific lines in the source code.
    sourceCodeUrlScheme = if (version_num != null) "\(sourceCode)/blob/\(version_num)%{path}#L%{line}-L%{endLine}" else "\(sourceCode)/blob/main%{path}#L%{line}-L%{endLine}"

    // The documentation URL for the package.
    documentation = "https://schema.kdeps.com"

    // The license under which the package is distributed.
    license = "Apache-2.0"

    // A brief description of the package's purpose.
    description = "Core PKL modules for KDEPS"
}

dependencies {
    ["k8s.contrib"] = import("external/pkl-pantry/packages/k8s.contrib/PklProject")
    ["pkl.pipe"] = import("external/pkl-pantry/packages/pkl.pipe/PklProject")
    ["openapi"] = import("external/pkl-pantry/packages/org.openapis.v3/PklProject")
    ["org.openapis.v3.contrib"] = import("external/pkl-pantry/packages/org.openapis.v3.contrib/PklProject")
    ["jsonschema"] = import("external/pkl-pantry/packages/org.json_schema/PklProject")
    ["jsonschema.contrib"] = import("external/pkl-pantry/packages/org.json_schema.contrib/PklProject")
    ["syntax"] = import("external/pkl-pantry/packages/pkl.experimental.syntax/PklProject")
    ["toml"] = import("external/pkl-pantry/packages/pkl.toml/PklProject")
    ["deepToTyped"] = import("external/pkl-pantry/packages/pkl.experimental.deepToTyped/PklProject")
    ["k8s"] { uri = "package://pkg.pkl-lang.org/pkl-k8s/k8s@1.0.1" }
}
