@go.Package { name = "github.com/kdeps/schema/gen/api_server_request" }

open module org.kdeps.pkl.APIServerRequest

import "package://pkg.pkl-lang.org/pkl-go/pkl.golang@0.5.0#/go.pkl"

hidden apiMethodRegex = Regex(#"^(?i:(GET|POST|PUT|PATCH|OPTIONS|DELETE|HEAD))"#)
hidden isValidHTTPMethod = (str) ->
  if (str.matches(apiMethodRegex))
    true
  else
    throw("Error: Invalid HTTP method. The provided HTTP method is not supported. Please use one of the following methods: GET, POST, PUT, PATCH, DELETE, OPTIONS, or HEAD.")

path: Uri
method: String(isValidHTTPMethod)
data: String?
params: Mapping<String, String>?
headers: Mapping<String, String>?
filename: String?
filetype: String?

function data(): String = if (data != "") data.base64Decoded else ""
function filename(): String = if (filename != "") filename.base64Decoded else ""
function param(name: String): String =
        if (params.getOrNull(name) != null)
                params[name].base64Decoded
        else
                ""
function header(name: String): String =
        if (headers.getOrNull(name) != null)
                headers[name].base64Decoded
        else
                ""
// For consistency
function path(): String = path
function method(): String = method
function filetype(): String = filetype
